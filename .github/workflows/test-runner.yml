name: Test GitHub Runner

on:
  workflow_dispatch:
    inputs:
      network_tier:
        description: 'Network tier to test'
        required: true
        default: 'lower'
        type: choice
        options:
          - lower
          - higher
          - monitoring

jobs:
  test-runner:
    runs-on: ${{ fromJSON(format('["self-hosted", "github-runner-{0}"]', inputs.network_tier)) }}
    
    steps:
      - name: Test Runner Connectivity
        run: |
          echo "=== Runner Test Started ==="
          echo "Runner: $(hostname)"
          echo "Network Tier: ${{ inputs.network_tier }}"
          echo "Date: $(date)"
          echo "User: $(whoami)"
          
      - name: Test System Info
        run: |
          echo "=== System Information ==="
          uname -a
          df -h
          free -h
          
      - name: Test Network Connectivity
        run: |
          echo "=== Network Tests ==="
          curl -s https://api.github.com/zen
          ping -c 3 8.8.8.8
          
      - name: Test Docker (if available)
        run: |
          echo "=== Docker Test ==="
          docker --version || echo "Docker not installed"
          
      - name: Test Kubernetes Access
        run: |
          echo "=== Kubernetes Test ==="
          kubectl version --client || echo "kubectl not available"
          
      - name: Success
        run: |
          echo "âœ… Runner test completed successfully!"
          echo "Runner is working properly on network tier: ${{ inputs.network_tier }}"