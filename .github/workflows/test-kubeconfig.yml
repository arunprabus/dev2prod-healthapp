name: Test Kubeconfig Access

on:
  workflow_dispatch:
    inputs:
      network:
        description: 'Network to test'
        required: true
        default: 'lower'
        type: choice
        options:
          - lower
          - higher
          - monitoring

jobs:
  test-kubeconfig:
    runs-on: [self-hosted, github-runner-lower]
    
    steps:
      - name: Test Kubeconfig Access
        env:
          KUBECONFIG_SECRET: ${{ github.event.inputs.network == 'lower' && secrets.KUBECONFIG_DEV || github.event.inputs.network == 'higher' && secrets.KUBECONFIG_PROD || secrets.KUBECONFIG_MONITORING }}
        run: |
          echo "ğŸ”§ Testing kubeconfig access for ${{ github.event.inputs.network }} network"
          
          # Use clean kubeconfig without TLS conflicts
          export KUBECONFIG=scripts/kubeconfig/kubeconfig-clean.yaml
          
          # Test cluster access
          echo "ğŸ“‹ Testing cluster connection..."
          kubectl cluster-info
          
          echo "ğŸ” Getting nodes with details..."
          kubectl get nodes -o wide
          
          echo "ğŸ“¦ Getting namespaces..."
          kubectl get namespaces
          
          echo "ğŸš€ Getting pods in all namespaces..."
          kubectl get pods --all-namespaces -o wide
          
          # Test completed
          
          echo "âœ… Kubeconfig test completed successfully!"